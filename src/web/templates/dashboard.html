<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centaur Parting - Astrophotography Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --bs-body-bg: #121212;
            --bs-body-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --table-hover: #2d2d2d;
            --bs-table-bg: #1e1e1e;
            --bs-table-color: #e0e0e0;
            --bs-table-hover-bg: #2d2d2d;
            --navbar-bg: #0a0a0a;
            --stat-card-bg: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%);
            --border-color: #444;
            --filename-color: #ffffff;
            --metrics-color: #b0b0b0;
        }
        
        [data-bs-theme="light"] {
            --bs-body-bg: #f8f9fa;
            --bs-body-color: #212529;
            --card-bg: #ffffff;
            --table-hover: #f5f5f5;
            --navbar-bg: #212529;
            --stat-card-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --border-color: #dee2e6;
            --filename-color: #212529;
            --metrics-color: #6c757d;
        }
        
        body {
            background-color: var(--bs-body-bg);
            color: var(--bs-body-color);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }
        
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .navbar {
            background-color: var(--navbar-bg) !important;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .table {
            color: var(--bs-body-color);
            border-color: var(--border-color);
        }
        
        .table-hover tbody tr:hover {
            background-color: var(--table-hover);
        }
        
        .stat-card {
            background: var(--stat-card-bg);
            color: white;
            border: none;
        }
        
        .stat-card .card-body {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.375rem;
        }
        
        .analysis-card {
            border-left: 4px solid #0d6efd;
        }
        
        .saturation-warning {
            border-left: 4px solid #dc3545 !important;
        }
        
        .fits-table td {
            vertical-align: middle;
            cursor: help;
        }
        
        /* Two-line file display */
        .file-display {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .filename-line {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--filename-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        
        .metrics-line {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.75rem;
            color: var(--metrics-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .badge-exposure-good { background-color: #198754; }
        .badge-exposure-high { background-color: #fd7e14; }
        .badge-exposure-low { background-color: #dc3545; }
        .sky-badge-dark { background-color: #0d6efd; }
        .sky-badge-bright { background-color: #6c757d; }
        
        .column-tooltip {
            border-bottom: 1px dashed #666;
            cursor: help;
        }
        
        .refresh-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        [data-bs-theme="light"] .refresh-controls {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }
        
        .progress-bar-refresh {
            background: linear-gradient(90deg, #198754, #0dcaf0);
            transition: width 1s linear;
            border-radius: 3px;
        }
        
        .rig-table {
            font-size: 0.85rem;
        }
        
        .rig-table td {
            padding: 4px 8px;
            border: none;
        }
        
        .rig-table th {
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-bs-theme="light"] .rig-table th {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .analysis-count {
            font-weight: bold;
            color: #0dcaf0;
        }
        
        /* Equal height cards */
        .equal-height-card {
            height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .equal-height-card .card-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Rig summary card specific */
        .rig-summary-card .card-body {
            padding: 1rem;
        }
        
        /* Modal styling */
        .modal-content {
            background-color: var(--card-bg);
            color: var(--bs-body-color);
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-footer {
            border-top: 1px solid var(--border-color);
        }
        
        /* Toast styling */
        .toast {
            background-color: var(--card-bg);
            color: var(--bs-body-color);
            border: 1px solid var(--border-color);
        }
        
        .toast-header {
            background-color: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--border-color);
        }
        
        /* Button improvements */
        .btn {
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Pagination styling */
        .page-link {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            color: var(--bs-body-color);
        }
        
        .page-link:hover {
            background-color: var(--table-hover);
            border-color: var(--border-color);
        }
        
        .page-item.active .page-link {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        
        /* Alert styling */
        .alert {
            background-color: rgba(13, 110, 253, 0.1);
            border: 1px solid rgba(13, 110, 253, 0.3);
            color: var(--bs-body-color);
        }
        
        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-active {
            background-color: #198754;
            box-shadow: 0 0 8px #198754;
        }
        
        .status-inactive {
            background-color: #6c757d;
        }
        
        .status-error {
            background-color: #dc3545;
            box-shadow: 0 0 8px #dc3545;
        }
        
        /* Code block styling for modal */
        .code-block {
            background: #0a0a0a;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            border: 1px solid #333;
        }
        
        /* Filter badge colors */
        .filter-Ha { background-color: #dc3545; color: white; }
        .filter-OIII { background-color: #0dcaf0; color: white; }
        .filter-SII { background-color: #fd7e14; color: white; }
        .filter-L { background-color: #6c757d; color: white; }
        .filter-R { background-color: #dc3545; color: white; }
        .filter-G { background-color: #198754; color: white; }
        .filter-B { background-color: #0d6efd; color: white; }
        
        /* Rig badge colors */
        .rig-Rig24 { background-color: #6f42c1; color: white; }
        .rig-Rig15 { background-color: #0dcaf0; color: white; }
        .rig-Rig08 { background-color: #fd7e14; color: white; }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .equal-height-card {
                height: auto;
                margin-bottom: 15px;
            }
            
            .refresh-controls .btn-group {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .theme-toggle {
                bottom: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .file-display {
                min-width: 150px;
            }
        }
        
        /* Filter controls */
        .filter-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        
        .filter-label {
            font-weight: 600;
            color: #0dcaf0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-stars me-2"></i> Centaur Parting
                <small class="ms-2 opacity-75">Astrophotography Tracker</small>
            </a>
            <div class="navbar-text">
                <span class="status-indicator status-active"></span>
                <span id="connection-status" class="badge bg-success me-2">Connected</span>
                <span id="current-time" class="text-muted">--:--:--</span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <!-- Dashboard Stats -->
        <div class="row mb-4">
            <!-- Rig Summary Card -->
            <div class="col-md-4">
                <div class="card equal-height-card stat-card">
                    <div class="card-body">
                        <h5 class="card-title d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-camera-video me-2"></i>Rig Summary</span>
                            <span class="badge bg-dark" id="total-files-count">0</span>
                        </h5>
                        <div class="rig-table mt-2">
                            <table class="table table-borderless mb-0">
                                <thead>
                                    <tr>
                                        <th>Rig</th>
                                        <th>Telescope</th>
                                        <th>Camera</th>
                                        <th class="text-end">Files</th>
                                    </tr>
                                </thead>
                                <tbody id="rig-summary-table">
                                    <tr>
                                        <td colspan="4" class="text-center py-3">
                                            <div class="spinner-border spinner-border-sm text-light me-2" role="status"></div>
                                            <span class="text-light">Loading rig data...</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Last Data Update Card -->
            <div class="col-md-4">
                <div class="card equal-height-card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-clock-history me-2"></i>Last Data Update
                        </h5>
                        <h2 class="display-6 mb-2" id="last-update-time">--:--:--</h2>
                        <p class="card-text mb-0" id="last-update-status">
                            <small>Waiting for first update...</small>
                        </p>
                        <div class="mt-auto">
                            <small class="text-light opacity-75">
                                <i class="bi bi-info-circle me-1"></i>Auto-refresh enabled
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Watcher Status Card -->
            <div class="col-md-4">
                <div class="card equal-height-card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-eye me-2"></i>Watcher Status
                        </h5>
                        <h2 class="display-6 mb-2">
                            <span class="badge bg-danger" id="watcher-status-badge">Stopped</span>
                        </h2>
                        <p class="card-text mb-2" id="watcher-status-text">
                            <span class="status-indicator status-inactive"></span>
                            Not monitoring
                        </p>
                        <div class="mt-auto">
                            <small class="text-light opacity-75">
                                <i class="bi bi-folder me-1"></i>/Volumes/Rig24_Imaging
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Refresh Controls -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card refresh-controls">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-lg-4 mb-3 mb-lg-0">
                                <div class="btn-group w-100" role="group">
                                    <button id="start-watcher-btn" class="btn btn-success btn-sm">
                                        <i class="bi bi-play-circle me-1"></i> Start
                                    </button>
                                    <button id="stop-watcher-btn" class="btn btn-danger btn-sm" disabled>
                                        <i class="bi bi-stop-circle me-1"></i> Stop
                                    </button>
                                    <button id="refresh-now-btn" class="btn btn-info btn-sm">
                                        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                                    </button>
                                    <button id="process-existing-btn" class="btn btn-warning btn-sm">
                                        <i class="bi bi-gear me-1"></i> Process All
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-lg-5 mb-3 mb-lg-0">
                                <div class="row g-2 align-items-center">
                                    <div class="col-auto">
                                        <label class="form-label mb-0">Refresh Rate:</label>
                                    </div>
                                    <div class="col">
                                        <select class="form-select form-select-sm" id="refresh-rate-select">
                                            <option value="5000">5 seconds</option>
                                            <option value="10000" selected>10 seconds</option>
                                            <option value="30000">30 seconds</option>
                                            <option value="60000">1 minute</option>
                                            <option value="0">Off</option>
                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="auto-refresh-toggle" checked>
                                            <label class="form-check-label" for="auto-refresh-toggle">Auto</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3">
                                <div class="d-flex align-items-center">
                                    <span class="me-2">Theme:</span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-secondary active" id="dark-theme-btn">
                                            <i class="bi bi-moon-stars"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary" id="light-theme-btn">
                                            <i class="bi bi-sun"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Refresh Progress -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="me-2">Refresh progress:</span>
                                    <div class="flex-grow-1">
                                        <div class="progress" style="height: 8px;">
                                            <div id="refresh-progress" class="progress-bar progress-bar-refresh" 
                                                 role="progressbar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted" id="next-refresh-text">
                                        <i class="bi bi-clock me-1"></i>Next refresh: --
                                    </small>
                                    <small class="text-muted" id="refresh-rate-text">
                                        <i class="bi bi-speedometer me-1"></i>Rate: 10s
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status Messages -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="alert alert-dark" id="watcher-info">
                                    <div class="d-flex">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <div>
                                            <strong>New Files Only Mode:</strong> Only files added AFTER starting the watcher will be analyzed.
                                            <br><small>Use "Process All" to analyze existing files.</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Analyses -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-table me-2"></i>Recent FITS Analyses
                        </h5>
                        <div>
                            <span class="badge bg-primary me-2" id="displayed-files-count">
                                <i class="bi bi-file-earmark me-1"></i>0 files
                            </span>
                        </div>
                    </div>
                    
                    <!-- Filter Controls -->
                    <div class="card-body border-bottom">
                        <div class="filter-controls">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="filter-group">
                                        <span class="filter-label">Rig:</span>
                                        <button class="btn btn-sm btn-outline-secondary active" data-filter-rig="all">All Rigs</button>
                                        <button class="btn btn-sm btn-outline-secondary" data-filter-rig="Rig24">Rig24</button>
                                        <button class="btn btn-sm btn-outline-secondary" data-filter-rig="Rig15">Rig15</button>
                                        <button class="btn btn-sm btn-outline-secondary" data-filter-rig="Rig08">Rig08</button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="filter-group">
                                        <span class="filter-label">Filter:</span>
                                        <button class="btn btn-sm btn-outline-secondary active" data-filter-type="all">All Filters</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-Ha" data-filter-type="Ha">Ha</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-OIII" data-filter-type="OIII">OIII</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-SII" data-filter-type="SII">SII</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-L" data-filter-type="L">L</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-R" data-filter-type="R">R</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-G" data-filter-type="G">G</button>
                                        <button class="btn btn-sm btn-outline-secondary filter-B" data-filter-type="B">B</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-12">
                                    <small class="text-muted">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Showing: <span id="current-filter-display">All files</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover fits-table mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="column-tooltip" title="Filename and timestamp of acquisition">
                                            <i class="bi bi-file-earmark me-1"></i>File & Metrics
                                        </th>
                                        <th class="column-tooltip" title="Astronomical target name">
                                            <i class="bi bi-star me-1"></i>Object
                                        </th>
                                        <th class="column-tooltip" title="Filter used (L, R, G, B, Ha, OIII, SII)">
                                            <i class="bi bi-funnel me-1"></i>Filter
                                        </th>
                                        <th class="column-tooltip" title="Camera/Telescope combination">
                                            <i class="bi bi-camera me-1"></i>Rig
                                        </th>
                                        <th class="column-tooltip" title="Telescope model">
                                            <i class="bi bi-telescope me-1"></i>Telescope
                                        </th>
                                        <th class="column-tooltip" title="Camera model">
                                            <i class="bi bi-camera-video me-1"></i>Camera
                                        </th>
                                        <th class="column-tooltip" title="Exposure time (seconds)">
                                            <i class="bi bi-clock me-1"></i>Exposure
                                        </th>
                                        <th class="column-tooltip" title="Guiding RMS (arcseconds)">
                                            <i class="bi bi-bullseye me-1"></i>RMS
                                        </th>
                                        <th class="column-tooltip" title="Sky brightness (mag/arcsec²)">
                                            <i class="bi bi-cloud-moon me-1"></i>Sky
                                        </th>
                                        <th class="column-tooltip" title="Signal-to-Noise Ratio">
                                            <i class="bi bi-graph-up me-1"></i>SNR
                                        </th>
                                        <th class="column-tooltip" title="Star count">
                                            <i class="bi bi-stars me-1"></i>Stars
                                        </th>
                                        <th class="column-tooltip" title="Half-Flux Radius (arcseconds)">
                                            <i class="bi bi-circle me-1"></i>HFR
                                        </th>
                                        <th class="column-tooltip" title="Saturation status">
                                            <i class="bi bi-exclamation-triangle me-1"></i>Status
                                        </th>
                                        <th class="column-tooltip" title="Actions">
                                            <i class="bi bi-gear me-1"></i>Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="analyses-table">
                                    <!-- Sample data for testing the two-line display -->
                                    <tr class="analysis-card">
                                        <td>
                                            <div class="file-display">
                                                <div class="filename-line" title="NGC7000_Ha_300s_G80_RMS_0.35_2024-01-15T22:30:45.fits">
                                                    NGC7000_Ha_300s_G80_RMS_0.35_2024-01-15T22:30:45.fits
                                                </div>
                                                <div class="metrics-line" title="Exp:300s | Gain:80 | Temp:-10°C | RMS:0.35">
                                                    Exp:300s | Gain:80 | Temp:-10°C | RMS:0.35
                                                </div>
                                            </div>
                                        </td>
                                        <td>NGC 7000</td>
                                        <td><span class="badge filter-Ha">Ha</span></td>
                                        <td><span class="badge rig-Rig24">Rig24</span></td>
                                        <td>Askar V-80</td>
                                        <td>QHYminiCam8M</td>
                                        <td><span class="badge bg-success">300s</span></td>
                                        <td><span class="badge bg-info">0.35"</span></td>
                                        <td><span class="badge sky-badge-dark">20.8</span></td>
                                        <td><span class="badge bg-success">42.6</span></td>
                                        <td><span class="badge bg-secondary">127</span></td>
                                        <td><span class="badge bg-secondary">2.1"</span></td>
                                        <td><span class="badge bg-success">Good</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-info view-analysis" data-filename="sample1.fits">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr class="analysis-card">
                                        <td>
                                            <div class="file-display">
                                                <div class="filename-line" title="M31_L_120s_G75_RMS_0.42_2024-01-15T23:15:22.fits">
                                                    M31_L_120s_G75_RMS_0.42_2024-01-15T23:15:22.fits
                                                </div>
                                                <div class="metrics-line" title="Exp:120s | Gain:75 | Temp:-15°C | RMS:0.42">
                                                    Exp:120s | Gain:75 | Temp:-15°C | RMS:0.42
                                                </div>
                                            </div>
                                        </td>
                                        <td>M31</td>
                                        <td><span class="badge filter-L">L</span></td>
                                        <td><span class="badge rig-Rig15">Rig15</span></td>
                                        <td>William Optics GT81</td>
                                        <td>ZWO ASI1600MM</td>
                                        <td><span class="badge bg-warning">120s</span></td>
                                        <td><span class="badge bg-info">0.42"</span></td>
                                        <td><span class="badge sky-badge-bright">19.2</span></td>
                                        <td><span class="badge bg-warning">28.4</span></td>
                                        <td><span class="badge bg-secondary">89</span></td>
                                        <td><span class="badge bg-secondary">1.8"</span></td>
                                        <td><span class="badge bg-warning">Moderate</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-info view-analysis" data-filename="sample2.fits">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="mt-3">
                            <nav aria-label="Analysis pagination">
                                <ul class="pagination justify-content-center mb-0" id="pagination">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Modal -->
    <div class="modal fade" id="analysisModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-file-earmark-text me-2"></i>FITS Analysis Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="analysis-modal-body">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading analysis details...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Close
                    </button>
                    <button type="button" class="btn btn-primary" id="export-analysis-btn">
                        <i class="bi bi-download me-1"></i>Export JSON
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggle Button (simplified) -->
    <button class="btn btn-outline-secondary theme-toggle" id="theme-toggle" title="Toggle theme">
        <i class="bi bi-moon-stars"></i>
    </button>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notification-toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <small class="text-muted" id="toast-time">just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-message">
                <!-- Toast message will go here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    
    <script>
    // Initialize theme to dark by default
    document.addEventListener('DOMContentLoaded', function() {
        // Set dark theme as default
        document.documentElement.setAttribute('data-bs-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl, {
                delay: {show: 500, hide: 100}
            });
        });
        
        // Theme toggle buttons
        const darkThemeBtn = document.getElementById('dark-theme-btn');
        const lightThemeBtn = document.getElementById('light-theme-btn');
        const themeToggle = document.getElementById('theme-toggle');
        
        function setTheme(theme) {
            document.documentElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
            
            // Update button states
            if (theme === 'dark') {
                darkThemeBtn.classList.add('active');
                lightThemeBtn.classList.remove('active');
                themeToggle.innerHTML = '<i class="bi bi-moon-stars"></i>';
            } else {
                lightThemeBtn.classList.add('active');
                darkThemeBtn.classList.remove('active');
                themeToggle.innerHTML = '<i class="bi bi-sun"></i>';
            }
        }
        
        // Button event listeners
        darkThemeBtn.addEventListener('click', () => setTheme('dark'));
        lightThemeBtn.addEventListener('click', () => setTheme('light'));
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-bs-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });
        
        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            setTheme(savedTheme);
        }
        
        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('current-time').textContent = timeString;
            
            // Update toast time if visible
            const toastTime = document.getElementById('toast-time');
            if (toastTime) {
                toastTime.textContent = timeString;
            }
        }
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);
        
        // Filter buttons - Rig
        document.querySelectorAll('[data-filter-rig]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all rig filter buttons
                document.querySelectorAll('[data-filter-rig]').forEach(b => {
                    b.classList.remove('active');
                });
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get the filter values
                const rigFilter = this.getAttribute('data-filter-rig');
                const filterType = document.querySelector('[data-filter-type].active')?.getAttribute('data-filter-type') || 'all';
                
                // Update filter display
                updateFilterDisplay(rigFilter, filterType);
                
                // Here you would typically filter the table
                // This would be implemented in dashboard.js
                console.log(`Rig filter: ${rigFilter}, Type filter: ${filterType}`);
            });
        });
        
        // Filter buttons - Filter Type
        document.querySelectorAll('[data-filter-type]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all type filter buttons
                document.querySelectorAll('[data-filter-type]').forEach(b => {
                    b.classList.remove('active');
                });
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get the filter values
                const rigFilter = document.querySelector('[data-filter-rig].active')?.getAttribute('data-filter-rig') || 'all';
                const filterType = this.getAttribute('data-filter-type');
                
                // Update filter display
                updateFilterDisplay(rigFilter, filterType);
                
                // Here you would typically filter the table
                // This would be implemented in dashboard.js
                console.log(`Rig filter: ${rigFilter}, Type filter: ${filterType}`);
            });
        });
        
        // Function to update filter display text
        function updateFilterDisplay(rigFilter, typeFilter) {
            const displayElement = document.getElementById('current-filter-display');
            let displayText = '';
            
            if (rigFilter === 'all' && typeFilter === 'all') {
                displayText = 'All files';
            } else if (rigFilter === 'all') {
                displayText = `All rigs, ${typeFilter} filter`;
            } else if (typeFilter === 'all') {
                displayText = `${rigFilter}, all filters`;
            } else {
                displayText = `${rigFilter}, ${typeFilter} filter`;
            }
            
            displayElement.textContent = displayText;
        }
        
        // View analysis buttons
        document.querySelectorAll('.view-analysis').forEach(btn => {
            btn.addEventListener('click', function() {
                const filename = this.getAttribute('data-filename');
                console.log(`View analysis for: ${filename}`);
                // This would trigger the modal load in dashboard.js
            });
        });
        
        // Add some sample data for rig summary (for testing)
        setTimeout(() => {
            const rigTable = document.getElementById('rig-summary-table');
            if (rigTable && rigTable.innerHTML.includes('Loading rig data')) {
                rigTable.innerHTML = `
                    <tr>
                        <td><strong>Rig24</strong></td>
                        <td>Askar V-80+Reducer</td>
                        <td>QHYminiCam8M</td>
                        <td class="text-end"><span class="badge bg-primary">42</span></td>
                    </tr>
                    <tr>
                        <td><strong>Rig15</strong></td>
                        <td>William Optics GT81</td>
                        <td>ZWO ASI1600MM</td>
                        <td class="text-end"><span class="badge bg-primary">18</span></td>
                    </tr>
                    <tr>
                        <td><strong>Rig08</strong></td>
                        <td>Celestron RASA 8</td>
                        <td>ZWO ASI2600MC</td>
                        <td class="text-end"><span class="badge bg-primary">7</span></td>
                    </tr>
                `;
                document.getElementById('total-files-count').textContent = '67';
                document.getElementById('displayed-files-count').innerHTML = '<i class="bi bi-file-earmark me-1"></i>2 files';
            }
        }, 1500);
    });
    </script>
</body>
</html>
